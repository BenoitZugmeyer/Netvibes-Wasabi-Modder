
var tabs = require("tabs");

var script = 'var $,$$,App,Fx,_;window.addEvent("domready",function(){var f=App.SmartReader,a=f.Feed.loadIframe.bind(f.Feed);f.Feed.loadIframe=function(n){var k=f.UI.Feeds.iFrame,m;if(k&&k.sandbox){k.destroy();f.UI.Feeds.iFrame=null}try{a(n)}catch(l){console.log(l)}k=f.UI.Feeds.iFrame;m=k.get("src");if(m.match(/^http:\\/\\/t37\\.net/)||m.match(/FredericDeVillamilcom/)){k.set("sandbox","allow-scripts allow-forms allow-same-origin")}};function e(){var q=$("top"),m=$("addContentLink"),l=m.getSize().y,p=new Fx.Tween(q),n=true,k=function(){p.start("top",n?-l:0);o.set("class",n?"out":"in");n=!n},o=new Element("div",{id:"topbar-button","class":"out",events:{click:k}}).inject(q);q.setStyle("margin-bottom",-l);p.set("top",-l);k();m.addEvent("click",function(){n=true;k()})}function i(){var n=$("smartreader-feeds-showFilter").getElement("a"),k=n.retrieve("events").click.keys[0],l=new Element("span",{text:parseInt(App.pageCustom.smartreader.onlyUnread)?_("Show all items"):_("Show only unread items")}),m=function(){var o=l.get("text");n.set({title:o,id:o==_("Show only unread items")?"display-unread":"display-all"})};n.removeEvent("click",k).addEvent("click",function(){k.apply(l);m()});m()}function b(){if(!Browser.Engine.webkit){return}var l=f.UI.sidebarHandler.retrieve("events").mouseenter.keys[0],n=f.UI.sidebar.retrieve("events").mouseleave.keys[0],m=document.getElement(".nv-treeview-container"),k=0;f.UI.sidebarHandler.removeEvent("mouseenter",l).addEvent("mouseenter",function(){l();m.scrollTo(0,k)});f.UI.sidebar.removeEvent("mouseleave",n).addEvent("mouseleave",function(){k=m.getScroll().y;n()})}function h(){if(!$("smartreader-container")){return}var l=$("smartreader-feeds-headerBottom").getChildren(),k;l.reverse();l.inject($("smartreader-feeds-headerTop").getChildren()[0],"after");$("smartreader-feeds-headerTop").getElements("a").each(function(m){m.set("title",m.get("text"))});$("smartreader-feeds-markRead-dropdown").destroy();k=$("smartreader-feeds-headerViewSwitcher").inject($("top").getElement(".right"),"top");k.getElement(".separator").inject(k,"after");k.getElement(".separator").destroy();i();b()}function j(){if(!App.SmartReader.UI){return}var m=f.resizeApp.bind(f),k,l=App.SmartReader.UI.Feeds.main;f.resizeApp=function(){var n=l.getScroll(),o;m();o=window.getSize().y;this.UI.Feeds.main.setStyle("height",o-this.UI.Feeds.main.getOffsets().y);this.UI.Feeds.container.setStyle("max-height",o-this.UI.Feeds.container.getOffsets().y-10);l.scrollTo(n.x,n.y)};k=f.resizeApp.bind(f);window.removeEvents("resize").removeEvents("load").addEvents({resize:k,load:function(){k();k.delay(1000)}});k()}function d(){var o=$("divTabs"),n,l,m;if(!o){return}l=o.getElement("ul");if(!l){return}function k(){[l,$("aNewTab")].each(function(p){p.toggle()});m=l.getStyle("display")=="none";n.set("text",m?">":"<");Cookie.write("NWM_HideTabs",m?"yes":"no",{duration:365})}n=new Element("div",{id:"tabsToggler",text:"<"}).inject(o,"top").addEvent("click",k);m=Cookie.read("NWM_HideTabs");if(m=="yes"){k()}}function g(n,m,k){var l=n[m].bind(n);n[m]=k(l)}function c(){var l=App.SmartReader.Feed,n=App.SmartReader.UI.Feeds.main;function k(p){var o=n.getScroll();n.setStyle("overflow-y","hidden");n.scrollTo(o.x,o.y);f.resizeApp()}function m(){n.setStyle("overflow-y","auto")}g(l,"closeActive",function(o){return function(){var p=App.SmartReader.UI.Feeds.container.getElement(".active");if(p&&p.hasClass("websiteview")){m()}o()}});g(l,"putFocusOnEntry",function(o){return function(p,q){o(p,q);if(p.hasClass("websiteview")){k(p)}else{m()}}});g(l,"switchToWebsiteView",function(o){return function(p){o(p);k(p)}});g(l,"switchToFeedView",function(o){return function(p){o(p);m()}})}d();e();h();j();c()});';

var css = '#smartreader-newItemsMessage a{color:#000!important;font-weight:bold!important;}#smartreader-feeds-headerViewSwitcher{float:none!important;display:inline;}#smartreader-feeds-headerBottom,#smartreader-feeds-headerMaximize,#playermp3Container,#footer,#notification-box,#topLinks{display:none!important;}#smartreader-feeds-header{padding:3px 0 0!important;}#smartreader-mainTreeView,#smartreader-feeds-main{border-width:0!important;}#smartreader-main{padding:0!important;margin:0!important;}.icon.entry-markasunread,.icon.entry-markasread{background-position:50% 50%!important;margin-right:-8px;margin-top:-8px;padding:8px;}#smartreader-feeds-markRead{margin-left:8px!important;}#smartreader-sidebar{-webkit-box-shadow:black 10px 0 20px -10px;box-shadow:black 10px 0 20px -10px;-moz-box-shadow:black 10px 0 20px -10px;padding-left:0!important;position:relative!important;}.quickDisplaySidebar #smartreader-sidebar{position:absolute!important;}#smartreader-feeds-headerTop{padding:0 10px 0 20px;border-width:0!important;}.header-button-set{height:auto!important;}#smartreader-feeds-headerViewSwitcher .header-button.selected,#smartreader-feeds-headerViewSwitcher .header-button:hover{border:1px solid #7c7c7c!important;border-radius:3px!important;-moz-border-radius:3px!important;background:-webkit-gradient(linear,0% 0,0 100%,from(#747474),to(#535353))!important;background:-moz-linear-gradient(top,#747474,#535353)!important;}#smartreader-feeds-headerViewSwitcher .header-button{margin-right:5px;border:1px solid transparent!important;line-height:16px;height:16px;margin-top:3px;width:22px;overflow:hidden;padding:0 2px;}#smartreader-feeds-headerViewSwitcher-list span{background-position:-7px -317px!important;}#smartreader-feeds-headerViewSwitcher-expanded span{background-position:-7px -344px!important;}#smartreader-feeds-headerViewSwitcher-mosaic span{background-position:-7px -371px!important;}#application{clear:both;}#top{position:absolute;left:0;right:0;height:28px!important;background-color:transparent!important;z-index:1000!important;}#smartreader-feeds-markRead-a,#smartreader-feeds-markRead-a:hover{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAACeSURBVDiN7ZWxDQMhDEW/lVAhNzCDb6XbLQNEykp4BlfoysjpkI5QBOnS8Toonh4UNrk7/sG9O99UdXf3bUZCREVEXgDeQ7Gq7iGEBzPHGXGt9VBViMhzKHb3jZljznnGCwDRzE6v7L8CAKCqU9aU0tfdUCwiU2Iz+028ihuruLGKG6u4cXkxEZVa65FSmh70RFROrm7nXbaaevFlfACsXmNNHbiMFwAAAABJRU5ErkJggg==)!important;}#smartreader-feeds-headerBottom-prev span{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEXSURBVDjLY/j//z8DJZiBLgZkz37Ynjrz4ReyDEideb89afrDf5ET7v4n2YCEqXf7qpY9/T9r76v/Xu03STMgasLteaVLHv+fufvl/6k7X/y3qrlCvAHBvTeXFC54ANbctv7p/95Nz/5rFZ0nzoCAzpuPsuc++D91x4v/jasf/y9aeP9/89rH/6VTTxJngGPDtc3xU+/879789H/5kgf/02fd+V+17OF/yZhjxBmgVXCaRT3v7BqP1mv/a1Y+/J824/b/woX3/osHHSAtECVjjqy0Lb/wP2/+3f+Zs+/8F3XfS3o0inntXWSeffJ/0tRb/0Ucdv4nKyEJW25ZYBh/5L+w5fb/ZCdlQYMNs4WMt/wfuMyEDwMA0Irn/pDRT58AAAAASUVORK5CYII=)!important;}#smartreader-feeds-headerBottom-next span{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEdSURBVDjLY/j//z8DJZiB6gY0rH7xpW7li3YKDHj1v2bli38lix61k2VA5fJn/9eeeP+/fcOL/wlT7/aRbEDegkf/Vxx/93/xobf/S5c8/u/ecm0eSQYkTX/4f+HBN/8nbX/xf+bul/8Tp9/9r1N0dgnRBgT33QZqfPW/YdXj/42rH//v2vjkv3fHtf9SScceEWWAc8u1/xO2Pv9fsvjB//IlD4CGPPrvXH/5v2Tksc1EGWBaful/+/on/4sW3gfGxsP/9lUX/ksEH1gj6rqdhSgDlPPO/q9b8fB/5bIH/23LL/wXD9i7kqRAlEo6+b908f3/NiXn/4t57V1EcjRKRB75b1145r+o684FZCUkMb8D/0Uct88euMxEKgYA7Ojrv4CgE7EAAAAASUVORK5CYII=)!important;}#display-all,#display-all:hover{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAC/SURBVDiN7dUxDoMwDAXQ77ZMKEuYGc2VuFsPUKm3YcYjc6aIsXI3JFIPsQSd+FKGRNGT7SEhVcUZeRT7u4iMqjp4ECKamfkN4GPCIjI2TfMMIbQeOOe8igiY+WXCqjqEENqu6zwuALQppV2X5SgAAH3fu9Rpmn7OTHhZFhecUqqDRcQFxxjrYGZ2wdUVXzPectqMr4q3HFHxzbpIRK5lxYRV1bWs/GfGRDTnnNcYo/uhJ6J5ZxWtHPY1lfBh+QLNooXAPCEidQAAAABJRU5ErkJggg==)!important;}#display-unread,#display-unread:hover{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAACtSURBVDiN7dUxCsMwDAXQ/9tmCp48Z3SulLv1AIXeJnM0evZkMhZ1jqNFkCwhHzxYmAcWWKaq4oy8mv1TRCZVHT0IySWl9AXwM2ERmbque4cQeg9ca11FBCmljwmr6hhC6GOMHhcA+lLK5pZtKwAAwzC41HmedzUTzjm74FLKrvawDpJ0LSsmrKquZeUiPT4iN3zDV4A3L4/kUmtdAbgHPcllYzVD5LCvqYUPyx/uQmq9/glgigAAAABJRU5ErkJggg==)!important;}#smartreader-feeds-header .header-button-set:hover{background:url(http://cdn.netvibes.com/themes/base/img/smartreader/grey-hover.png?v=456) repeat scroll 0 0 transparent;}#smartreader-feeds-headerBottom-prevNext:hover{background-image:url(http://cdn.netvibes.com/themes/base/img/smartreader/grey.png?v=456)!important;}#smartreader-feeds-headerBottom-prevNext a:hover{background:url(http://cdn.netvibes.com/themes/base/img/smartreader/grey-hover.png?v=456) repeat scroll 0 0 transparent;}#display-all,#display-unread,#smartreader-feeds-markRead-a,#smartreader-feeds-header .header-button span{height:22px;width:22px;font-size:0;background-position:center center!important;background-repeat:no-repeat!important;display:block;}#smartreader-feeds-headerBottom-prevNext a{padding:0!important;}#topbar-button{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFRSURBVDiN7ZQxbsJAEEX/7jrGHcIBCiSa3IAzpIpSpMhxUmBOwSlSpIhS5QwWF0iDBBImS7XWyqxnUiQgZ2MsZKXkVyPN7H/zp1jBzACAOI6T8Xg8jaIIRVGgjcIwhLUWy+VyprVOqj3ZyrGFLqALqBaUOecKIURrMyEEnHMFgMzvBZU6zfN83+12Q29mlqZpUmc8mUwSANPj1lIiz/M9gNSfrSZaGGPCmkTTH8NGCPCdyBgTAlicBGmtDRFlzAylVCOsDqKUAjODiDKttfENqqcDM8/X6/XTaDSKrLUgIh92rH9tKyU6nQ5Wq5Vl5rkPAQBx+OsO6vf7L8Ph8K7X612VZQm//8dACCilsNvt9pvN5m273T6cBYrjOJJSPkspbweDgQqCIKh7eJBzzmVZVhLROxE9aq3tWaAK8AbAPYDrxkjAJ4BXrfVH09BJ0H/rC9ssmk6SuULDAAAAAElFTkSuQmCC);position:relative;margin:0 0 0 auto;top:22px;width:26px;cursor:pointer;z-index:1;}#topbar-button.out{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFRSURBVDiN7ZQxbsJAEEX/7jrGHcIBCiSa3IAzpIpSpMhxUmBOwSlSpIhS5QwWF0iDBBImS7XWyqxnUiQgZ2MsZKXkVyPN7H/zp1jBzACAOI6T8Xg8jaIIRVGgjcIwhLUWy+VyprVOqj3ZyrGFLqALqBaUOecKIURrMyEEnHMFgMzvBZU6zfN83+12Q29mlqZpUmc8mUwSANPj1lIiz/M9gNSfrSZaGGPCmkTTH8NGCPCdyBgTAlicBGmtDRFlzAylVCOsDqKUAjODiDKttfENqqcDM8/X6/XTaDSKrLUgIh92rH9tKyU6nQ5Wq5Vl5rkPAQBx+OsO6vf7L8Ph8K7X612VZQm//8dACCilsNvt9pvN5m273T6cBYrjOJJSPkspbweDgQqCIKh7eJBzzmVZVhLROxE9aq3tWaAK8AbAPYDrxkjAJ4BXrfVH09BJ0H/rC9ssmk6SuULDAAAAAElFTkSuQmCC);height:16px;}#topbar-button.in{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAKCAYAAACqnE5VAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFASURBVDiNrZI/bsIwGMV//pwmWUmBjaU34Aydqg4deiDgFJyiQ4eqU88QcYEuDJEINVOiKDh2FyKF8EcV6pMsPek9++fPsvLeA5AkyXwymcziOKaua25RGIZUVcV6vV4YY+bdTDo+t9bWSqmbIABKKay1NZD3sy4oLctyLyL9TleLwzorEaEsyz2Q9rOg41dFUYRXJlqkaToHmE6nALN+QSlFURQhsDq5RGuMMYVzLvfeo7W+CAE4+KPJtNZ473HO5caY4iIIwHu/zLKsiqKIzhMeQc7BRIQoisiyrPLeL/tdANX+ulbD4fB9PB4/DQaDu6Zp6OcnByiF1prdbrffbDaf2+325U+gJEliEXkTkcfRaKSDIAjObWxlrbV5njfOuS/n3KsxpvoTqAN8AJ6B+6sjwQ/wYYz5vla6CPpv/QLfbprXM2ouxwAAAABJRU5ErkJggg==);height:10px;}#smartreader-feeds-markRead .separator{display:none!important;}#tabsToggler{width:10px;height:31px;line-height:31px;position:absolute;left:0;font-weight:bold;font-size:.8em;text-align:center;cursor:pointer;}#columns{padding-top:0!important;}#savingStatus{position:absolute;}#divTabs{left:0;right:0;}.module{margin:10px 3px;}#smartreader-feeds-inner{padding:0!important;}.websiteview .entry-body{border-style:none!important;}';


tabs.onReady = function(tab) {
    var location = tab.location;
    var privatepage = /^http:\/\/(www\.)?netvibes.com\/privatepage\//;
    if(privatepage.test(location)) {
        var document = tab.contentDocument,
            window = tab.contentWindow;
        if(document.getElementById('modder_script')) return;

        var el = document.createElement('script');
        el.type = 'text/javascript';
        el.textContent = script;
        el.id = 'modder_script';
        document.body.appendChild(el);

        el = document.createElement('style');
        el.type = 'text/css';
        el.textContent = css;
        document.body.appendChild(el);
    }
}
